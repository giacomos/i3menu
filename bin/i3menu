#!/usr/bin/env python
# -*- coding: utf-8 -*-
import argparse
import sys
from i3menu import __about__
from i3menu.app import Application
from i3menu.app import menu_tree
from i3menu.menu import menu_list

descr = """{about.__title__} {about.__version__}
{about.__copyright__}
{about.__longlicense__}

Written by {about.__author__} <{about.__email__}>""".format(about=__about__)


class VersionAction(argparse.Action):
    def __call__(self, parser, namespace, values, option_string=None):
        print(descr)
        setattr(namespace, self.dest, values)
        sys.exit()


def run():
    parser = argparse.ArgumentParser(
        description='Provides rofi menus to interact with i3',
        prog='i3menu')
    parser.add_argument(
        '-v', '--version', action=VersionAction, nargs=0,
        help="display version information and exit")
    parser.add_argument(
        "--debug", action='store_true',
        help="Debug, print the i3 command before executing it"
    )
    parser.add_argument(
        "--menu-provider", dest='menu_provider',
        choices=['dmenu', 'rofi'],
        help="Force the use of a menu provider"
    )
    tree = menu_tree()
    options = menu_list(tree)
    parser.add_argument(
        "menu",
        choices=options,
        default='root', nargs='?',
        help="Menu to be executed. Allowed values are: " + ", ".join(options),
        metavar='<menu>')
    args = parser.parse_args()
    app = Application(args)
    sys.exit(app.run())

if __name__ == '__main__':
    run()
